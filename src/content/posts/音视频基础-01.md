---
title: 音视频基础-01
description: 简介音视频关键基础概念
pubDate: 2025-07-11
---

## 音视频录制原理

音视频录制原理类似。

```
麦克风--采样帧--音频处理--采样帧队列--音频编码（压缩）--音频包队列--｜
				时钟（同步）																		复用器（音频流，视频流，字幕流封装）-文件
摄像头--图像帧--图像处理--图像帧队列--视频编码（压缩）--视频包队列--｜
```

## 音视频播放原理

基本就是音视频录制反向过程。

```
					｜-音频包队列--音频解码--采样帧队列--音频处理--扬声器
媒体文件-解复用器													同步控制
					｜-视频包队列--视频解码--图像帧队列--图像处理--显示器
```

## 视频基础

- **像素**：（pixel=picture+element）是图像的基本单位。
- **分辨率**：指图像的大小或尺寸，通常使用像素表示。如360p（640*360）。
- **帧率**：FPS（每秒帧数），帧率越高，画面越流畅。
- **码率**：视频文件在单位时间内使用的数据量，如1Mbps。一般来说，同视频源，编码算法相同，码率越高，失真越小，视频越清晰。

### RGB

使用红、绿、蓝的相对强度组合成一个像素来表示颜色。

- **排列**：一般一个像素是RGB排列或BGR排列（opencv）。
- **位深**：彩色图片三通道RGB在计算机中表示时，一般每个通道是8bit，所以位深就是8bit。所以可以组成256^3=16,777,216 中颜色，我们称做24位真彩色。
- **透明度**：a，常见RGBA，ARGB，ABGR，BGRA。其中A就是透明度（alpha分量）。

### YUV

为了更好的兼容性（兼容黑白电视）以及更高的压缩率来节省存储空间和传输带宽，一般同等条件是RGB描述占用空间大小的2/3或1/2；图像还可以使用YUV来描述。

- **Y**：亮度，没有UV信息一样可以显示完整图像（黑白）。
- **U、V**：色度，降低色度采样率不会对图像质量产生很大影响，所以可以压缩。

#### 排列

**打包（packed）**：每个像素点的Y、U、V分量交叉排列。

```
YUVYUVYUVYUVYUVYUV
YUVYUVYUVYUVYUVYUV
YUVYUVYUVYUVYUVYUV
```

**平面（planar）**：使用三个数组分开连续存放Y、U、V三个分量。

```
YYYYYYYYYYYYYY
YYYYYYYYYYYYYY
UUUUUUUUUUUUUU
UUUUUUUUUUUUUU
VVVVVVVVVVVVVV
VVVVVVVVVVVVVV
```

#### YUV采样

表示Y、U、V的采样比例。

##### YUV4:4:4

一个Y分量对应一个U分量和一个V分量。

I444（YUV444P），ffmpeg中表示为AV_PIX_FMT_YUV444P，为平面排列。

##### YUV4:2:2

两个Y分量共用一个U分量和一个V分量。

I422（YUV422P），ffmpeg中表示为AV_PIX_FMT_YUV422P，平面排列。

##### YUV4:2:0（最常用）

四个Y分量共用一个U分量和一个V分量。

I420（YUV420P），ffmpeg中表示为AV_PIX_FMT_YUV420P，平面排列。

NV12，ffmpeg中表示为AV_PIX_FMT_NV12，Y平面排列，U和V打包排列。

### RGB和YUV转换

使用ffmpeg的swscale或libyuv库转换。

主要转换标准是BT601和BT709。

### I P B 帧

根据I、P、B帧的特点，可以判断帧的解码顺序与DTS。

#### I帧

可以独立解码，不需要参考其他画面生成。

采用帧内编码方式，其所占信息量较大，且其周期性出现在图像序列中（频率由编码器选择），是P和B帧的参考帧。

是帧组GOP的基础帧（第一帧），一个组中只有一个I帧，无需考虑运动矢量。

#### P帧

根据本帧和与其相邻的前一帧的不同点压缩本帧数据。

属于前向预测的帧间编码，需要参考前面最近的I帧或P帧解码。

#### B帧

B帧图像采用双向时间预测，可以大大提高压缩倍数。

### 常用视频压缩算法

MPEG2、H264、H265、AVS、VP8、VP9。

## 音频基础

声音是震动，属于模拟信号，可以分解为一系列的波。所以需要转化成数字信号才能处理。

**频率**：是T的倒数，表示声音在1s中的周期数。

**人能听到的声音频率范围**：20hz--20Khz。所以超出这个范围的可以视为冗余信号，不进行采样处理，节省空间和带宽。

**PCM**：脉冲编码调制，经过采样，量化，编码三个步骤将模拟信号转化为数字信号。

**采样频率**：每秒钟采样的点的个数。常见采样频率：22Khz、44.1Khz、48Khz、96Khz、192Khz。

**奈奎斯特采样定律**：简单来说就是采样频率大于等于信号最高频率2倍，原始信号就能完美从采样值中恢复。所以一般音频的采样频率是44.1Khz，略大于20Khz。

**量化**：将信号连续的幅值（离散信号）用离散有限的值表示，就是量化，越高的位数就能表示更多的离散值，量化出来就更平滑。将离散信号量化为数字信号。

**编码**：按照一定规律，将量化后的的值用二进制数字表示。

**比特率**：每秒传输bit数，可以间接衡量音频质量。未压缩音频比特率=采样频率\*采样精度\*通道数。

**码率**：压缩后的音频数据的比特率，码率越大，压缩率越低，音质越好。码率=音频文件大小/时长。

**帧**：每次编码的采样单元数，MP3通常是1152个采样点作为一个编码单元，AAC通常是1024个采样点作为一个编码单元。

**帧长**：可以指每帧的持续时间=每帧采样数/采样频率。也可以指压缩后每帧的数据长度。

**交错模式**：音频数据存储时，数据以连续帧存储方式存储，声道交替。

```
LRLRLRLRLRLRLRLR
```

**非交错模式**：首先记录一个周期内所有帧的一个声道样本，再是另一个声道样本。

```
LLLLLLLLRRRRRRRR
```

**频谱隐蔽效应**：一个频率的声音能量小于某个阈值后，人耳就听不到，所以当某个频率下有某个大能量声音出现后，该音频率附近的阈值就会提高，就会有低于该阈值的声音听不到，听不到的就是冗余信号，可以不发送，节省流量。

**时域隐蔽效应**：当强音信号和弱音信号同时出现或出现时间接近时的短暂时间内的弱音人听不到。可以视为冗余信号。

### 音频编码-压缩编码方法

```
音频采样信号--时域-频域映射--比特分配、量化、编码---比特流格式化
										心理声学模型
```

## 封装格式

将编码压缩好的视频流、音频流、字幕流按照一个规则打包到一个文件中，对于本地存储，网络传输，直播等需要不同的封装格式。

### 常见封装格式

FLV、MP4（这两种最常见，将H264+AAC）、MKV、AVI、F4V、RMVB、TS、WMV。

## 音视频同步

### DTS

解码时间戳，用于解码，告诉播放器在什么时候解码这一帧数据。

### PTS

显示时间戳，告诉播放器该在什么时候显示这一帧数据（音频和视频）。

### 音视频同步方式

#### Audio Master

将视频同步到音频。视频以音频为锚。

#### Video Master

同步音频到视频。音频以视频为锚。

#### External Clock Master

同步音频和视频到外部时钟

#### 一般选择顺序

Audio Master > External Clock Master > Video Master